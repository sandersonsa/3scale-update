sandersonsa@USU-E0FQ15C8F7S:/mnt/c/Users/sandersonsa/Documents/scripts-upgrade-3scale-27-28$ ./3_migration.sh
DEPLOYED_APP_LABEL is not empty
3scale-api-management
Confirm that the system-smtp secret has been created
apiVersion: v1
data:
  address: c210cC52aXJ0dWEuY29tLmJy
  authentication: ""
  domain: ""
  openssl.verify.mode: bm9uZQ==
  password: ""
  port: MjU=
  username: ""
kind: Secret
metadata:
  creationTimestamp: "2023-06-06T13:02:39Z"
  labels:
    app: 3scale-api-management
    threescale_component: system
    threescale_component_element: smtp
  name: system-smtp
  namespace: claro-3scale
  resourceVersion: "416338838"
  selfLink: /api/v1/namespaces/claro-3scale/secrets/system-smtp
  uid: 6a4ab962-046a-11ee-9d03-000c29c5d379
type: Opaque
Verifying all data smtp from system-smtp secret
��eUpdating pre-hook with new command
----------
deploymentconfig.apps.openshift.io/system-app patched
replication controller "system-app-16" successfully rolled out
Verifying new pre-hook command below
----------
[
  "bash",
  "-c",
  "bundle exec rake boot openshift:deploy"
]
Patching pre-hook with new command
----------
Warning: oc apply should be used on resource created by either oc create --save-config or oc apply
deploymentconfig.apps.openshift.io/system-app configured
Verifying length Master Access Token - expected 1)
----------
1
Verifying Master Access Token
----------
[
  {
    "name": "MASTER_ACCESS_TOKEN",
    "valueFrom": {
      "secretKeyRef": {
        "key": "MASTER_ACCESS_TOKEN",
        "name": "system-seed"
      }
    }
  }
]
Verifying SMTP Variables
----------
[
  {
    "name": "SMTP_ADDRESS",
    "valueFrom": {
      "secretKeyRef": {
        "key": "address",
        "name": "system-smtp"
      }
    }
  },
  {
    "name": "SMTP_USER_NAME",
    "valueFrom": {
      "secretKeyRef": {
        "key": "username",
        "name": "system-smtp"
      }
    }
  },
  {
    "name": "SMTP_PASSWORD",
    "valueFrom": {
      "secretKeyRef": {
        "key": "password",
        "name": "system-smtp"
      }
    }
  },
  {
    "name": "SMTP_DOMAIN",
    "valueFrom": {
      "secretKeyRef": {
        "key": "domain",
        "name": "system-smtp"
      }
    }
  },
  {
    "name": "SMTP_PORT",
    "valueFrom": {
      "secretKeyRef": {
        "key": "port",
        "name": "system-smtp"
      }
    }
  },
  {
    "name": "SMTP_AUTHENTICATION",
    "valueFrom": {
      "secretKeyRef": {
        "key": "authentication",
        "name": "system-smtp"
      }
    }
  },
  {
    "name": "SMTP_OPENSSL_VERIFY_MODE",
    "valueFrom": {
      "secretKeyRef": {
        "key": "openssl.verify.mode",
        "name": "system-smtp"
      }
    }
  }
]
./3_migration.sh: line 51: W: command not found
replication controller "system-app-16" successfully rolled out
Patching the environment of the system-app
----------
Error from server (BadRequest): unexpected EOF
Error from server (NotFound): deploymentconfigs.apps.openshift.io "type=json" not found
replication controller "system-app-16" successfully rolled out
Checking updates on containers
----------
system-developer
[
  {
    "name": "SMTP_ADDRESS",
    "valueFrom": {
      "configMapKeyRef": {
        "key": "address",
        "name": "smtp"
      }
    }
  },
  {
    "name": "SMTP_USER_NAME",
    "valueFrom": {
      "configMapKeyRef": {
        "key": "username",
        "name": "smtp"
      }
    }
  },
  {
    "name": "SMTP_PASSWORD",
    "valueFrom": {
      "configMapKeyRef": {
        "key": "password",
        "name": "smtp"
      }
    }
  },
  {
    "name": "SMTP_DOMAIN",
    "valueFrom": {
      "configMapKeyRef": {
        "key": "domain",
        "name": "smtp"
      }
    }
  },
  {
    "name": "SMTP_PORT",
    "valueFrom": {
      "configMapKeyRef": {
        "key": "port",
        "name": "smtp"
      }
    }
  },
  {
    "name": "SMTP_AUTHENTICATION",
    "valueFrom": {
      "configMapKeyRef": {
        "key": "authentication",
        "name": "smtp"
      }
    }
  },
  {
    "name": "SMTP_OPENSSL_VERIFY_MODE",
    "valueFrom": {
      "configMapKeyRef": {
        "key": "openssl.verify.mode",
        "name": "smtp"
      }
    }
  }
]
----------
system-provider
[
  {
    "name": "SMTP_ADDRESS",
    "valueFrom": {
      "configMapKeyRef": {
        "key": "address",
        "name": "smtp"
      }
    }
  },
  {
    "name": "SMTP_USER_NAME",
    "valueFrom": {
      "configMapKeyRef": {
        "key": "username",
        "name": "smtp"
      }
    }
  },
  {
    "name": "SMTP_PASSWORD",
    "valueFrom": {
      "configMapKeyRef": {
        "key": "password",
        "name": "smtp"
      }
    }
  },
  {
    "name": "SMTP_DOMAIN",
    "valueFrom": {
      "configMapKeyRef": {
        "key": "domain",
        "name": "smtp"
      }
    }
  },
  {
    "name": "SMTP_PORT",
    "valueFrom": {
      "configMapKeyRef": {
        "key": "port",
        "name": "smtp"
      }
    }
  },
  {
    "name": "SMTP_AUTHENTICATION",
    "valueFrom": {
      "configMapKeyRef": {
        "key": "authentication",
        "name": "smtp"
      }
    }
  },
  {
    "name": "SMTP_OPENSSL_VERIFY_MODE",
    "valueFrom": {
      "configMapKeyRef": {
        "key": "openssl.verify.mode",
        "name": "smtp"
      }
    }
  }
]
----------
system-master
[
  {
    "name": "SMTP_ADDRESS",
    "valueFrom": {
      "configMapKeyRef": {
        "key": "address",
        "name": "smtp"
      }
    }
  },
  {
    "name": "SMTP_USER_NAME",
    "valueFrom": {
      "configMapKeyRef": {
        "key": "username",
        "name": "smtp"
      }
    }
  },
  {
    "name": "SMTP_PASSWORD",
    "valueFrom": {
      "configMapKeyRef": {
        "key": "password",
        "name": "smtp"
      }
    }
  },
  {
    "name": "SMTP_DOMAIN",
    "valueFrom": {
      "configMapKeyRef": {
        "key": "domain",
        "name": "smtp"
      }
    }
  },
  {
    "name": "SMTP_PORT",
    "valueFrom": {
      "configMapKeyRef": {
        "key": "port",
        "name": "smtp"
      }
    }
  },
  {
    "name": "SMTP_AUTHENTICATION",
    "valueFrom": {
      "configMapKeyRef": {
        "key": "authentication",
        "name": "smtp"
      }
    }
  },
  {
    "name": "SMTP_OPENSSL_VERIFY_MODE",
    "valueFrom": {
      "configMapKeyRef": {
        "key": "openssl.verify.mode",
        "name": "smtp"
      }
    }
  }
]
----------
Patching the environment of the system-sidekiq
-----------
error: there is no need to specify a resource type as a separate argument when passing arguments in resource/name form (e.g. 'oc get resource/<resource_name>' instead of 'oc get resource resource/<resource_name>'
Verifying sidekiq smtp variables
[
  {
    "name": "SMTP_ADDRESS",
    "valueFrom": {
      "configMapKeyRef": {
        "key": "address",
        "name": "smtp"
      }
    }
  },
  {
    "name": "SMTP_USER_NAME",
    "valueFrom": {
      "configMapKeyRef": {
        "key": "username",
        "name": "smtp"
      }
    }
  },
  {
    "name": "SMTP_PASSWORD",
    "valueFrom": {
      "configMapKeyRef": {
        "key": "password",
        "name": "smtp"
      }
    }
  },
  {
    "name": "SMTP_DOMAIN",
    "valueFrom": {
      "configMapKeyRef": {
        "key": "domain",
        "name": "smtp"
      }
    }
  },
  {
    "name": "SMTP_PORT",
    "valueFrom": {
      "configMapKeyRef": {
        "key": "port",
        "name": "smtp"
      }
    }
  },
  {
    "name": "SMTP_AUTHENTICATION",
    "valueFrom": {
      "configMapKeyRef": {
        "key": "authentication",
        "name": "smtp"
      }
    }
  },
  {
    "name": "SMTP_OPENSSL_VERIFY_MODE",
    "valueFrom": {
      "configMapKeyRef": {
        "key": "openssl.verify.mode",
        "name": "smtp"
      }
    }
  }
]
replication controller "system-sidekiq-16" successfully rolled out
Upgrading 3scale Version Number
----------
Error from server (BadRequest): json: cannot unmarshal object into Go value of type jsonpatch.Patch
Verifying 3scale Version Number 2.8
----------
"2.7"
Upgrading 3scale ImageStreams
----------
1. amp-system imagestream
----------
imagestream.image.openshift.io/amp-system patched
imagestream.image.openshift.io/amp-system patched
replication controller "system-app-16" successfully rolled out
replication controller "system-sphinx-2" successfully rolled out
replication controller "system-sidekiq-16" successfully rolled out
----------
2. amp-apicast imagestream
----------
imagestream.image.openshift.io/amp-apicast patched
imagestream.image.openshift.io/amp-apicast patched
replication controller "apicast-staging-5" successfully rolled out
replication controller "apicast-production-7" successfully rolled out
----------
3. amp-backend imagestream
----------
imagestream.image.openshift.io/amp-backend patched
imagestream.image.openshift.io/amp-backend patched
replication controller "backend-listener-1" successfully rolled out
replication controller "backend-worker-1" successfully rolled out
replication controller "backend-cron-1" successfully rolled out
----------
4. amp-zync imagestream
----------
imagestream.image.openshift.io/amp-zync patched
imagestream.image.openshift.io/amp-zync patched
replication controller "zync-30" successfully rolled out
replication controller "zync-que-17" successfully rolled out
----------
5. amp-memcached imagestream
----------
imagestream.image.openshift.io/system-memcached patched
imagestream.image.openshift.io/system-memcached patched
replication controller "system-memcache-1" successfully rolled out
----------
6. Setting AMP_RELEASE to 2.8
----------
deploymentconfig.apps.openshift.io/system-app updated
Waiting for rollout to finish: 0 out of 1 new replicas have been updated...
Waiting for rollout to finish: 1 old replicas are pending termination...
Waiting for rollout to finish: 1 old replicas are pending termination...
Waiting for latest deployment config spec to be observed by the controller loop...
Waiting for latest deployment config spec to be observed by the controller loop...
replication controller "system-app-17" successfully rolled out
----------
7. Creating Tags for ImageStreams that did not changed
----------
imagestream.image.openshift.io/zync-database-postgresql patched
imagestream.image.openshift.io/zync-database-postgresql patched
replication controller "zync-database-1" successfully rolled out
imagestream.image.openshift.io/backend-redis patched
imagestream.image.openshift.io/backend-redis patched
replication controller "backend-redis-1" successfully rolled out
imagestream.image.openshift.io/system-redis patched
imagestream.image.openshift.io/system-redis patched
replication controller "system-redis-1" successfully rolled out
imagestream.image.openshift.io/system-mysql patched
error: unable to parse "[{\"op\": \"add\", \"path\": \"/spec/tags/-\", \"value\":{\"annotations\": {\"openshift.io/display-name\": \"System MySQL (latest)\"}, \"from\": { \"kind\":\"ImageStreamTag\", \"name\": \"2.8\"}, \"name\": \"latest\", \"referencePolicy\": {\"type\": \"Source\"}}}": yaml: line 1: did not find expected ',' or ']'
replication controller "system-mysql-1" successfully rolled out
----------
Verifying new imagen in DeploymentConfigs
----------
apicast-production image: "registry.redhat.io/3scale-amp2/apicast-gateway-rhel7@sha256:b1e312b49e48b85441b515b710ff17b420bfd1eab9f9f8730f080e3f5ab7b75c"
apicast-staging image: "registry.redhat.io/3scale-amp2/apicast-gateway-rhel7@sha256:b1e312b49e48b85441b515b710ff17b420bfd1eab9f9f8730f080e3f5ab7b75c"
backend-cron image: "registry.redhat.io/3scale-amp2/backend-rhel7@sha256:b8b45fca90fa9eba973e236a203472e5ea5b27f6bc1cf6fcc34dea6d461e69ca"
backend-listener image: "registry.redhat.io/3scale-amp2/backend-rhel7@sha256:b8b45fca90fa9eba973e236a203472e5ea5b27f6bc1cf6fcc34dea6d461e69ca"
backend-redis image: "registry.redhat.io/rhscl/redis-32-rhel7@sha256:a9bdf52384a222635efc0284db47d12fbde8c3d0fcb66517ba8eefad1d4e9dc9"
backend-worker image: "registry.redhat.io/3scale-amp2/backend-rhel7@sha256:b8b45fca90fa9eba973e236a203472e5ea5b27f6bc1cf6fcc34dea6d461e69ca"
system-app image: "registry.redhat.io/3scale-amp2/system-rhel7@sha256:96b325135a96c9085ec71ebee7ee8c33bdcf9e5eaf3c3730fa4dccac4380b1a3"
system-memcache image: "registry.redhat.io/3scale-amp2/memcached-rhel7@sha256:f4be0092780f5789da6cd17c685ce47aa9386987da28828002d211197822c714"
system-mysql image: "registry.redhat.io/rhscl/mysql-57-rhel7@sha256:9a781abe7581cc141e14a7e404ec34125b3e89c008b14f4e7b41e094fd3049fe"
system-redis image: "registry.redhat.io/rhscl/redis-32-rhel7@sha256:a9bdf52384a222635efc0284db47d12fbde8c3d0fcb66517ba8eefad1d4e9dc9"
system-sidekiq image: "registry.redhat.io/3scale-amp2/system-rhel7@sha256:96b325135a96c9085ec71ebee7ee8c33bdcf9e5eaf3c3730fa4dccac4380b1a3"
system-sphinx image: "registry.redhat.io/3scale-amp2/system-rhel7@sha256:96b325135a96c9085ec71ebee7ee8c33bdcf9e5eaf3c3730fa4dccac4380b1a3"
zync image: "registry.redhat.io/3scale-amp2/zync-rhel7@sha256:a17fbb5ffac12255db4f4616ddf6c3f7749c85e9e3d6bc71bc3862b18658b7a2"
zync-database image: "registry.redhat.io/rhscl/postgresql-10-rhel7@sha256:bf7a6d358b3b6f5a542d061ef96955a1fe9dc1ecf7a60a7876bd2568ab022dc7"
zync-que image: "registry.redhat.io/3scale-amp2/zync-rhel7@sha256:a17fbb5ffac12255db4f4616ddf6c3f7749c85e9e3d6bc71bc3862b18658b7a2"
----------
Deleting smtp ConfigMap
----------
sandersonsa@USU-E0FQ15C8F7S:/mnt/c/Users/sandersonsa/Documents/scripts-upgrade-3scale-27-28$